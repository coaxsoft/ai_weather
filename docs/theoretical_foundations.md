# Theoretical foundations

Weather predictor is the machine that calculates new weather based on
the forecasting abilities of several weather services.

## Formulating a task

For simplicity, we assume that we have only two weather services,
let's name them *'EnglishWeather'* and *'FrenchWeather'*. We, also,
assume that we have weather service that generate true weather data;
let's name it as *'TrulyTruthService'*.

We assume that we already collected forecast on *N* days of
*'EnglishWeather'* and *'FrenchWeather'* services and we have true
values on these *N* days.

Our goal is using this information calculate **weight** for every
service and using these **weights** calculate more precise weather
prediction for every new data generated by these services (in out case
*'EnglishWeather'* and *'FrenchWeather'*).

Also, for simplicity we'll consider only air temperature as weather that
should be forecasted.

## Looking for solution

So, let's think. In order to calculate **weights** of services we need
to know how good weather services forecast weather. What if for each
service (*'EnglishWeather'* and *'FrenchWeather'*) we will calculate
forecast error or saying another words how far forecast values of specific
service is from *'TrulyTruthService'* values?

Lets calculate error for *'EnglishWeather'* with this formula

![formula](http://latex.codecogs.com/svg.latex?E_{e}%20=\frac{1}{N}%20\sum_i(V_{e}%20-%20V_{t})^2)


Where ![op](http://latex.codecogs.com/svg.latex?E_{e}) is calculated error,
![op](http://latex.codecogs.com/svg.latex?N) is amount of values,
![op](http://latex.codecogs.com/svg.latex?v_{e}) is
![op](http://latex.codecogs.com/svg.latex?i)'th value of *'EnglishWeather'* service,
![op](http://latex.codecogs.com/svg.latex?v_{t}) is
![op](http://latex.codecogs.com/svg.latex?i)'th value of *'TrulyTruthService'* service, summation is over the
![op](http://latex.codecogs.com/svg.latex?i) index,
![op](http://latex.codecogs.com/svg.latex?i=%20\overline{1:N}).

We'll use the same formula for *'FrenchWeather'* service and we'll got
the error ![op](http://latex.codecogs.com/svg.latex?E_{f}).

Now, we've got errors with which services forecast weather. It's
obvious that the less error service produces the bigger **weight**
it should have.

Let's write services errors in one vector ![op](http://latex.codecogs.com/svg.latex?E).

![formula](http://latex.codecogs.com/svg.latex?E%20=%20\begin{pmatrix}%20E_{e}%20\\\\%20E_{f}%20\end{pmatrix})

Normalize it and inverse according to 1 (and then normalize gained
vector). Normalization is proportional scaling of all elements in
vector that sum of these elements be equal to 1.

![formula](http://latex.codecogs.com/svg.latex?w%20=\left%20\|%201%20-%20%20\begin{Vmatrix}%20E_{e}%20\\\\%20E_{f}%20\end{Vmatrix}%20\right%20\|)

Now, we've got services errors related to each other. The more error
closer to 1 the more precise weather forecast service provides.

Let's calculate more precise weather forecast using these weights.
Such as weights vector is normalized to 1 this is very simple to do it.
Just sum new forecast of services weighted by their weights, i. e.

![formula](http://latex.codecogs.com/svg.latex?f%20=%20w_{e}*E_{e}%20+%20w_{f}*E_{f})

Now, we can easily scale this solution on any arbitrary amount of
services.

### Example

Let's look at the toy example. Suppose we collected weather for
`25.03.2018` that

* *'EnglishWeather'* - 4 degrees Celsius
* *'FrenchWeather'* - 6 degrees Celsius

And the real temperature that was in `25.03.2018`

* *'TrulyTruthService'* - 4 degrees Celsius.

Can you already guess which weights services will have?

So, firstly we calculate error vector:

![formula](http://latex.codecogs.com/svg.latex?E%20=%20\begin{pmatrix}(4%20-%204)^2%20\\\\%20(4%20-%206)^2%20\end{pmatrix}%20=%20\begin{pmatrix}0%20\\\\%204%20\end{pmatrix})

And normalize it via this formula ![formula](http://latex.codecogs.com/svg.latex?w%20=\left%20\|%201%20-%20%20\begin{Vmatrix}%20E_{e}%20\\\\%20E_{f}%20\end{Vmatrix}%20\right%20\|)

![formula](http://latex.codecogs.com/svg.latex?w%20=\left%20\|1%20-%20\begin{Vmatrix}0%20\\\\%204%20\end{Vmatrix}\right%20\|=\left%20\|1%20-%20\begin{pmatrix}0%20\\\\%201%20\end{pmatrix}%20\right%20\|=%20\begin{Vmatrix}1%20\\\\%200%20\end{Vmatrix})

As expected *'EnglishWeather'* has total confidence because it has 100%
coincidence with true values, while *'FrenchWeather'* has 0% of
coincidence with true values, so its **weight** is equal to 0.
And calculating the new weather forecast by formula ![formula](http://latex.codecogs.com/svg.latex?f%20=%20w_{e}*E_{e}%20+%20w_{f}*E_{f})
we've got

![formula](http://latex.codecogs.com/svg.latex?f%20=%201*4%20+%200*6%20=%204)
